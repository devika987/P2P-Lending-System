{"ast":null,"code":"import _regeneratorRuntime from \"/home/devika/FinalYear/blockchain/BctProj/BctProj/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/devika/FinalYear/blockchain/BctProj/BctProj/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/devika/FinalYear/blockchain/BctProj/BctProj/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/devika/FinalYear/blockchain/BctProj/BctProj/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/devika/FinalYear/blockchain/BctProj/BctProj/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/devika/FinalYear/blockchain/BctProj/BctProj/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/devika/FinalYear/blockchain/BctProj/BctProj/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/devika/FinalYear/blockchain/BctProj/BctProj/client/src/components/newloanform.jsx\";\nimport React, { Component } from \"react\";\nimport { Redirect } from 'react-router-dom';\nimport SimpleLoanContract from \"../contracts/SimpleLoan.json\";\n\nvar NewLoanForm =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(NewLoanForm, _Component);\n\n  function NewLoanForm() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, NewLoanForm);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(NewLoanForm)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      formTitle: \"New Loan Request\",\n      web3: null,\n      toHome: false\n    };\n\n    _this.handleCreateRequest =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        var borrower, loanAmount, web3, loanTitle, owner, SimpleLoan;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n                borrower = e.target.borrowerAddr.value;\n                loanAmount = e.target.loanAmt.value != '' ? _this.state.web3.utils.toWei(e.target.loanAmt.value, 'ether') : \"0\";\n                web3 = _this.state.web3;\n\n                if (web3.utils.isAddress(borrower)) {\n                  _context.next = 7;\n                  break;\n                }\n\n                _this.setState({\n                  hasError: true,\n                  errorMessage: 'Borrower address is not a valid address in the network'\n                });\n\n                return _context.abrupt(\"return\");\n\n              case 7:\n                loanTitle = e.target.loanTitle.value;\n                owner = _this.state.web3.eth.coinbase;\n                SimpleLoan = new _this.state.web3.eth.Contract(SimpleLoanContract.abi);\n                SimpleLoan.deploy({\n                  data: SimpleLoanContract.bytecode\n                }).send({\n                  from: _this.state.web3.eth.coinbase\n                }).on('error', function (error) {\n                  console.log(error);\n\n                  _this.setState({\n                    hasError: true,\n                    errorMessage: error.message\n                  });\n                }).then(function (newInstance) {\n                  var newContract = {\n                    contractAddress: newInstance.options.address,\n                    borrowerAddress: borrower,\n                    amount: loanAmount,\n                    title: loanTitle\n                  };\n                  var STORAGE_KEY = 'contracts';\n\n                  if (localStorage.hasOwnProperty(STORAGE_KEY)) {\n                    var value = localStorage.getItem(STORAGE_KEY);\n                    var contracts = JSON.parse(value);\n                    contracts.push(newContract);\n                    localStorage.setItem(STORAGE_KEY, JSON.stringify(contracts));\n                  } else {\n                    var _contracts = [newContract];\n                    localStorage.setItem(STORAGE_KEY, JSON.stringify(_contracts));\n                  } // Should have add a constructor to accept borrower and loan amount to avoid 2 transaction.\n                  // The original idea is to borrower create a contract to request, broker review and then set up\n                  // the request and send it. For this demo, the admin / broker do both together.\n\n\n                  newInstance.methods.request(borrower, loanAmount).send({\n                    from: owner\n                  }).then(function (r) {\n                    console.log(r);\n\n                    _this.props.onNewLoan(newContract);\n\n                    _this.setState({\n                      toHome: true\n                    });\n                  });\n                });\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    return _this;\n  }\n\n  _createClass(NewLoanForm, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.onTitle(this.state.formTitle);\n      this.setState({\n        web3: this.props.web3\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.toHome === true) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 68\n          },\n          __self: this\n        });\n      }\n\n      return React.createElement(\"form\", {\n        onSubmit: this.handleCreateRequest,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        type: \"button\",\n        className: \"close\",\n        \"data-dismiss\": \"alert\",\n        \"aria-label\": \"Close\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        \"aria-hidden\": \"true\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73\n        },\n        __self: this\n      }, \"\\xD7\")), this.state.hasError ? React.createElement(\"div\", {\n        class: \"alert alert-danger\",\n        role: \"alert\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76\n        },\n        __self: this\n      }, this.state.errorMessage) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"form-group\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 81\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }, \"Title:\"), React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        id: \"loanTitle\",\n        placeholder: \"Loan Title\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"form-group\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88\n        },\n        __self: this\n      }, \"Borrower Address:\"), React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        id: \"borrowerAddr\",\n        \"aria-describedby\": \"borrowerAddress\",\n        placeholder: \"Enter borrower address\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91\n        },\n        __self: this\n      }), React.createElement(\"small\", {\n        id: \"borrowerAddress\",\n        className: \"form-text text-muted\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92\n        },\n        __self: this\n      }, \"Ethereum Address\")), React.createElement(\"div\", {\n        className: \"form-group\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95\n        },\n        __self: this\n      }, \"Loan Amount:\"), React.createElement(\"input\", {\n        type: \"text\",\n        className: \"form-control\",\n        id: \"loanAmt\",\n        placeholder: \"Loan Amount In Ether\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96\n        },\n        __self: this\n      })), React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"btn btn-primary mr-2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      }, \"Create Request\"));\n    }\n  }]);\n\n  return NewLoanForm;\n}(Component);\n\nexport default NewLoanForm;","map":{"version":3,"sources":["/home/devika/FinalYear/blockchain/BctProj/BctProj/client/src/components/newloanform.jsx"],"names":["React","Component","Redirect","SimpleLoanContract","NewLoanForm","state","formTitle","web3","toHome","handleCreateRequest","e","preventDefault","borrower","target","borrowerAddr","value","loanAmount","loanAmt","utils","toWei","isAddress","setState","hasError","errorMessage","loanTitle","owner","eth","coinbase","SimpleLoan","Contract","abi","deploy","data","bytecode","send","from","on","error","console","log","message","then","newInstance","newContract","contractAddress","options","address","borrowerAddress","amount","title","STORAGE_KEY","localStorage","hasOwnProperty","getItem","contracts","JSON","parse","push","setItem","stringify","methods","request","r","props","onNewLoan","onTitle"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Redirect } from 'react-router-dom';\nimport SimpleLoanContract from \"../contracts/SimpleLoan.json\"; \n\nclass NewLoanForm extends Component {\n    state = {formTitle: \"New Loan Request\", web3: null, toHome: false }\n    componentDidMount() {\n        this.props.onTitle(this.state.formTitle)\n        this.setState({web3: this.props.web3});\n    }\n    \n\n    handleCreateRequest = async(e) => {\n        e.preventDefault();\n        \n        let borrower = e.target.borrowerAddr.value;\n        let loanAmount = e.target.loanAmt.value != '' ? this.state.web3.utils.toWei(e.target.loanAmt.value, 'ether') : \"0\";\n        const { web3 } = this.state;\n        if (!web3.utils.isAddress(borrower)) {\n            this.setState({hasError: true, errorMessage: 'Borrower address is not a valid address in the network'});\n            return;\n        }\n\n        let loanTitle = e.target.loanTitle.value;\n        let owner = this.state.web3.eth.coinbase;\n        let SimpleLoan = new this.state.web3.eth.Contract(SimpleLoanContract.abi);\n        SimpleLoan.deploy({\n            data: SimpleLoanContract.bytecode\n        }).send({\n            from: this.state.web3.eth.coinbase\n        })\n        .on('error', (error) => { \n            console.log(error);\n            this.setState({hasError: true, errorMessage: error.message});\n        })\n        .then((newInstance) => {\n            let newContract = {\n                contractAddress: newInstance.options.address,\n                borrowerAddress: borrower,\n                amount: loanAmount,\n                title: loanTitle            \n            }\n            \n            const STORAGE_KEY = 'contracts';\n            if (localStorage.hasOwnProperty(STORAGE_KEY)) {\n                let value = localStorage.getItem(STORAGE_KEY);\n                let contracts = JSON.parse(value);\n                contracts.push(newContract);\n                localStorage.setItem(STORAGE_KEY, JSON.stringify(contracts));\n            } else {\n                let contracts = [newContract];\n                localStorage.setItem(STORAGE_KEY, JSON.stringify(contracts));\n            }\n            \n            // Should have add a constructor to accept borrower and loan amount to avoid 2 transaction.\n            // The original idea is to borrower create a contract to request, broker review and then set up\n            // the request and send it. For this demo, the admin / broker do both together.\n            newInstance.methods.request(borrower, loanAmount).send({from: owner}).then(r => {\n                console.log(r);\n                this.props.onNewLoan(newContract);\n                this.setState({toHome: true});\n            });\n        });\n    }\n\n    render() {\n        if (this.state.toHome === true) {\n            return <Redirect to='/'/>\n        }\n        return (\n            <form onSubmit={this.handleCreateRequest}>\n                  <button type=\"button\" className=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                  </button>\n                { this.state.hasError ? (\n                    <div class=\"alert alert-danger\" role=\"alert\">\n                        {this.state.errorMessage}\n                    </div>\n                  ) : (<div></div>)\n                }\n                <div className=\"form-group\">\n                    <label>\n                        Title: \n                    </label>\n                    <input type=\"text\" className=\"form-control\" id=\"loanTitle\"  placeholder=\"Loan Title\" />\n                </div>\n                <div className=\"form-group\">\n                    <label>\n                        Borrower Address: \n                    </label>\n                    <input type=\"text\" className=\"form-control\" id=\"borrowerAddr\" aria-describedby=\"borrowerAddress\" placeholder=\"Enter borrower address\" />\n                    <small id=\"borrowerAddress\" className=\"form-text text-muted\">Ethereum Address</small>\n                </div>\n                <div className=\"form-group\">\n                    <label>Loan Amount:</label>\n                    <input type=\"text\" className=\"form-control\" id=\"loanAmt\" placeholder=\"Loan Amount In Ether\"/>\n                </div>\n               \n               \n                <button type='submit' className=\"btn btn-primary mr-2\">Create Request</button>\n            </form>\n        );\n    }\n}\n\nexport default NewLoanForm;\n"]},"metadata":{},"sourceType":"module"}